<!DOCTYPE html SYSTEM "about:legacy-compat">
<html manifest="pamflet.manifest">
      <head>
        <title>Stopwatch - profiling scala code — Combined Pages</title>
        <link type="text/css" media="screen, projection" rel="stylesheet" href="css/blueprint/screen.css"></link>
        <link type="text/css" media="screen and (min-device-width: 800px), projection" rel="stylesheet" href="css/blueprint/grid.css"></link>
        <link type="text/css" media="print" rel="stylesheet" href="css/blueprint/print.css"></link> 
        <!--[if lt IE 8]>
          <link rel="stylesheet" href="css/blueprint/ie.css" type="text/css" media="screen, projection"/>
        <![endif]-->
        <link type="text/css" media="screen, projection" rel="stylesheet" href="css/pamflet.css"></link>
        <link type="text/css" media="print" rel="stylesheet" href="css/pamflet-print.css"></link>
        <link type="text/css" media="screen and (min-device-width: 800px), projection" rel="stylesheet" href="css/pamflet-grid.css"></link>
        <link type="text/css" media="screen, projection" rel="stylesheet" href="css/custom.css"></link>
        <script src="js/jquery-1.6.2.min.js"></script>
        <script src="js/jquery.collapse.js"></script>
        <script src="js/pamflet.js"></script>
        <script type="text/javascript" src="js/prettify/prettify.js"></script><script type="text/javascript" src="js/prettify/lang-scala.js"></script><link type="text/css" rel="stylesheet" href="css/prettify.css"></link><script type="text/javascript"><!--
        window.onload=function() { prettyPrint(); };
      --></script>
        <meta charset="utf-8"></meta>
        <meta name="viewport" content="width=device-width, initial-scale=1"></meta>
        
      </head>
      <body>
        <a class="page prev nav" href="Contents+in+Depth.html">
            <span class="space">&nbsp;</span>
            <span class="flip">&gt;</span>
          </a>
        <div class="container">
          <div class="span-16 prepend-1 append-1">
            <div class="top nav span-16 title">
              <span>Stopwatch - profiling scala code</span> — Combined Pages
            </div>
          </div>
          <div class="span-16 prepend-1 append-1 contents">
            <div class="tocwrapper show">
      <a class="tochead nav" style="display: none" href="#toc">❦</a>
      <a name="toc"></a>
      <h4 class="toctitle">Contents</h4>
      <div class="tocbody">
      <div><a href="#Stopwatch+-+profiling+scala+code">Stopwatch - profiling scala code</a></div><ol class="toc"> <li><div><a href="#Measuring+your+code">Measuring your code</a></div></li><li><div><a href="#Groups">Groups</a></div></li><li><div><a href="#Enabling+and+disabling">Enabling and disabling</a></div></li><li><div><a href="#Time+Distribution">Time Distribution</a></div></li><li><div><a href="#Web+Interface">Web Interface</a></div></li> </ol></div></div><h1 id="Stopwatch+-+profiling+scala+code">Stopwatch - profiling scala code</h1><p>This small Scala library can be used to determine application performance bottlenecks, user/application interactions, and application scalability. Each stopwatch gathers summary statistics such as hits, execution times (total, average, minimum, maximum, standard deviation), distribution, simultaneous requests or concurrent threads.
</p><p>This library was created from original works by by Alex Boisvert and originally posted @ <a  href="https://github.com/aboisvert/stopwatch">https://github.com/aboisvert/stopwatch</a>.
</p><p>This version of the library is maintained on GitHub @ <a  href="https://github.com/sbt-android-mill/stopwatch">https://github.com/sbt-android-mill/stopwatch</a>. 
</p><p><a  href="http://sbt-android-mill.github.com/stopwatch/core-api/">Core API</a>
</p><p><a  href="http://sbt-android-mill.github.com/stopwatch/web-api/">Web API</a>
</p><p>Please email any suggestions or errata to:
</p><p><a  href="&#x6d;&#x61;&#x69;&#108;&#116;&#111;&#x3a;&#101;&#122;&#x68;&#64;&#101;&#x7a;&#104;&#46;&#x6d;&#115;&#x6b;&#46;&#114;&#x75;">Alexey Aksenov</a>
</p><h4 id="Stopwatch+statistics">Stopwatch statistics</h4><ul><li>Hits
</li><li>Execution times
</li><li>Total, average, minimum, maximum, std dev, distribution
</li><li>Simultaneous requests / concurrent threads
</li><li>Errors and exceptions
</li></ul><p>(All over a given time interval)
</p><h3 id="Setup">Setup</h3><pre><code class="prettyprint lang-scala">libraryDependencies ++= Seq(
  &quot;org.digimead&quot; %% &quot;stopwatch-core&quot; % &quot;0.1&quot;
  &quot;org.digimead&quot; %% &quot;stopwatch-web&quot; % &quot;0.1&quot;
)

resolvers += &quot;stopwatch&quot; at &quot;http://sbt-android-mill.github.com/stopwatch/releases&quot;
</code></pre><p>Download jar files directly from the <a  href="http://sbt-android-mill.github.com/stopwatch/releases/org/digimead/">Maven 2 repository</a>
</p><h2 id="Target+platform">Target platform</h2><ul><li>Scala 2.8.2, 2.9.1, 2.9.2 (request for more if needed)
</li><li>JVM 1.5+
</li><li>No 3rd-party library dependencies.
</li></ul><h2 id="Legal">Legal</h2><p>Copyright 2009-2010 <a  href="&#x6d;&#97;&#105;&#108;&#x74;&#x6f;&#58;&#97;&#x6c;&#x65;&#x78;&#x2e;&#98;&#x6f;&#x69;&#x73;&#x76;&#101;&#x72;&#x74;&#x40;&#103;&#109;&#x61;&#x69;&#108;&#x2e;&#99;&#111;&#109;">Alex Boisvert</a> <br/>
Copyright 2012 <a  href="&#x6d;&#97;&#x69;&#108;&#116;&#111;&#x3a;&#x65;&#122;&#x68;&#x40;&#x65;&#x7a;&#104;&#x2e;&#109;&#x73;&#107;&#46;&#114;&#117;">Alexey Aksenov</a>
</p><p>Licensed under the Apache License, Version 2.0 (the “License”).
</p><p>You may obtain a copy of the License at <a  href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>
</p><p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an “AS IS” BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</p><p>See the License for the specific language governing permissions and limitations under the License.
</p><h1 id="Measuring+your+code">Measuring your code</h1><pre><code class="prettyprint lang-scala">import stopwatch.Stopwatch

// A stopwatch surrounds your code
Stopwatch(&quot;someName&quot;) {
  // code being timed
  doSomething()
  somethingElse()
}
</code></pre><h3 id="Non-inlined+code">Non-inlined code</h3><p>Sometimes you want to measure the performance of an operation which is not emcompassed by a single code section.  You can then use the <strong>start</strong> and <strong>stop</strong> methods to delimit the scope of the operation.
</p><pre><code class="prettyprint lang-scala">// get a stopwatch instance
val stopwatch = Stopwatch.start(&quot;test&quot;)

// and later, elsewhere in your code
// use the same instance to signal completion
stopwatch.stop()

// if there was an error, use error() instead
stopwatch.error()
</code></pre><p>These <strong>start</strong>, <strong>stop</strong> and <strong>error</strong> methods can also be used directly by JVM languages other than Scala (e.g. Java, Closure, Groovy) to provide more idiomatic wrappers for inlined code measurement.
</p><h1 id="Groups">Groups</h1><p><strong>StopwatchGroup</strong>’s are useful to organize stopwatches, avoid name clashes, and specify behavior for multiple stopwatches at once.
</p><p>The singleton <strong>Stopwatch</strong> object that has been used so far in the examples is actually the default <strong>StopwatchGroup</strong>.  You can define other stopwatch groups, each having their own distribution range and enabled/disabled state.
</p><p>By default, groups are disabled and have no defined range.
</p><pre><code class="prettyprint lang-scala">import stopwatch.Stopwatch
import stopwatch.StopwatchGroup
import stopwatch.TimeUnit._

val incomingRequests = new StopwatchGroup(&quot;Incoming Requests&quot;)

// configure
incomingRequests.enabled = true
incomingRequests.range = StopwatchRange(0 seconds, 30 seconds, 1000 millis)

// usage for code blocks
incomingRequests(clientId) {
  doStuffForClient()
}
</code></pre><h1 id="Enabling+and+disabling">Enabling and disabling</h1><p>There are 3 ways to manage if and how stopwatches are enabled.
</p><h2 id="At+the+group+level">At the group level</h2><p>As we have seen above, you can enable/disable stopwatches at the group level,
</p><pre><code class="prettyprint lang-scala">// the default group
Stopwatch.enabled = true

// or if you created your own group
myStopwatchGroup.enabled = false
</code></pre><p>By default, groups are disabled.  You must explicitly enable them to monitor your application.   Also, the group’s <strong>enabled</strong> property overrides stopwatches’ <strong>enabled</strong> property (see below).
</p><h2 id="%E2%80%9COn+demand%E2%80%9C">“On demand“</h2><p>If a group is enabled and a new stopwatch name is used, the <strong>enableOnDemand</strong> property controls whether the new stopwatch is automatically enabled,
</p><pre><code class="prettyprint lang-scala">// the default group
Stopwatch.enableOnDemand = true

// or if you created your own group
myStopwatchGroup.enableOnDemand = false

// when enableOnDemand is false,
// you must explicitly enable stopwatches
myStopwatchGroup.enable(&quot;someCode&quot;)
</code></pre><p>Otherwise, non-preinitialized stopwatches are disabled by default.  If <strong>enableOnDemand</strong> is <strong>false</strong>, you must explicitly enable stopwatches (see below).
</p><h2 id="Individual+stopwatches">Individual stopwatches</h2><p>In addition to enabling/disabling at the group level, you can also enable and disable individual stopwatches explicitly,
</p><pre><code class="prettyprint lang-scala">// the default group
Stopwatch.enable(&quot;myCode&quot;)
// or...
Stopwatch.disable(&quot;myCode&quot;)

// if you created your own group
myStopwatchGroup.enable(&quot;myCode&quot;)
// or ...
myStopwatchGroup.disable(&quot;myCode&quot;)
</code></pre><h1 id="Time+Distribution">Time Distribution</h1><p>You can define a time distribution range on stopwatch groups to plot execution time distribution graphs.
</p><pre><code class="prettyprint lang-scala">import stopwatch.Stopwatch
import stopwatch.StopwatchRange
import stopwatch.TimeUnit._

// somewhere in your code, before using the stopwatch
// distribution:  0s to 15s in 500ms intervals
Stopwatch.range = StopwatchRange(0 seconds, 15 seconds, 500 millis)
</code></pre><h2 id="Resetting+statistics">Resetting statistics</h2><p>You may programmatically reset the values of stopwatches if your application has multiple cycles or if you want to recalibrate after the JVM (“HotSpot compiler”) has had time to optimize your code.
</p><pre><code class="prettyprint lang-scala">import stopwatch.Stopwatch

Stopwatch.reset(&quot;test&quot;)
</code></pre><h2 id="Displaying+statistics">Displaying statistics</h2><p>The “low-tech” way to display statistics is to use one of the <strong>toString</strong> methods: <strong>toShortString</strong>, <strong>toMediumString</strong>, <strong>toLongString</strong>.  This can be useful if you want to log statistics directly to the <strong>Console</strong> or through an existing logging frameworks, such as Log4J.
</p><pre><code class="prettyprint lang-scala">scala&gt; val stats = Stopwatch.snapshot(&quot;test&quot;)

// summary only
scala&gt; s.toShortString
res3: String = Stopwatch &quot;test&quot; {hit=2, min=1838ms, avg=2148ms, max=2457ms, total=4296ms, stdDev=437ms}
</code></pre><br/>
<pre><code class="prettyprint lang-scala">// includes thread info
scala&gt; s.toMediumString
res4: String = Stopwatch &quot;test&quot; {hits=2, throughput=0.814/s, minTime=1838ms, avgTime=2148ms, maxTime=2457ms, totalTime=4296ms, stdDev=437ms, currentThreads=0, avgThreads=1.50, maxThreads=2, first=2009-12-21 11:22:54.708 PST, last=2009-12-21 11:22:57.166 PST}
</code></pre><br/>
<pre><code class="prettyprint lang-scala">// includes threads + time distribution
scala&gt; s.toLongString
res5: String = Stopwatch &quot;test&quot; {hits=2, throughput=0.814/s, minTime=1838ms, avgTime=2148ms, maxTime=2457ms, totalTime=4296ms, stdDev=437ms, currentThreads=0, avgThreads=1.50, maxThreads=2, first=2009-12-21 11:22:54.708 PST, last=2009-12-21 11:22:57.166 PST} Distribution {under=0, 0-1000ms: 0, 1000-2000ms: 1, 2000-3000ms: 1, 3000-4000ms: 0, 4000-5000ms: 0, 5000-6000ms: 0, 6000-7000ms: 0, 7000-8000ms: 0, 8000-9000ms: 0, 9000-10000ms: 0, over=0}
</code></pre><p>The standard <strong>toString</strong> method is equivalent to <strong>toMediumString</strong>.
</p><p>You can also use the “StopwatchStatistic”:StopwatchStatistic.html interface to obtain only the information you need and display it differently.
</p><h1 id="Web+Interface">Web Interface</h1><p>The optional <strong>stopwatch-web.jar</strong> library provides a small embedded web server to monitor your application in a development/certification setting.  It does not yet provide any security beyond only opening “localhost” loopback-only port.
</p><p>You can embed the server by inserting the following code fragment in your application’s startup code:
</p><pre><code class="prettyprint lang-scala">import stopwatch.web.Server

val server = new stopwatch.web.Server

// register StopwatchGroups you want to monitor
server.groups ::= Stopwatch
server.groups ::= myStopwatchGruop

// configure port number
server.port = 9999

server.start()
</code></pre><h2 id="Try+it%21">Try it!</h2><p>You can try a sample of the web server by running,
</p><pre><code class="prettyprint lang-sh">% scala -cp stopwatch-1.x.jar:stopwatch-web-1.x.jar stopwatch.web.SampleServer
</code></pre><p>If you point your browser to “http://localhost:9999”:http://localhost:9999, you should see:
</p><p>!images/stopwatches-thumbnail.jpg!:images/stopwatches.png
</p><p>and by clicking on the distribution sparklines, you will see more details about the distribution range:
</p><p>!images/distribution-thumbnail.jpg!:images/distribution.png
</p>
          </div>
        </div>
        <a class="fork nav" href="http://github.com/sbt-android-mill/stopwatch"><img alt="Fork me on GitHub" src="img/fork.png"></img></a>
      </body>
    </html>